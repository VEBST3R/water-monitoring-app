<!DOCTYPE html>
<html>
<head>
    <title>–¢–µ—Å—Ç —ñ—Å—Ç–æ—Ä—ñ—ó WQI</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .device { border: 1px solid #ddd; margin: 10px; padding: 15px; border-radius: 5px; }
        .wqi-value { font-size: 24px; font-weight: bold; color: #2196F3; }
        .history { margin-top: 10px; }
        .history-point { background: #f5f5f5; margin: 5px 0; padding: 5px; border-radius: 3px; }
    </style>
</head>
<body>
    <h1>üåä –¢–µ—Å—Ç —ñ—Å—Ç–æ—Ä—ñ—ó WQI –¥–ª—è –≤—Å—ñ—Ö –ø—Ä–∏—Å—Ç—Ä–æ—ó–≤</h1>
    
    <div id="devices">
        –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...
    </div>

    <script>
        const devices = ['111001', '222002', '333003'];
        const deviceNames = {
            '111001': '–û—Å–Ω–æ–≤–Ω–∏–π —Ä–µ–∑–µ—Ä–≤—É–∞—Ä',
            '222002': '–†–µ–∑–µ—Ä–≤–Ω–∏–π —Ä–µ–∑–µ—Ä–≤—É–∞—Ä', 
            '333003': '–ê–≤–∞—Ä—ñ–π–Ω–∏–π —Ä–µ–∑–µ—Ä–≤—É–∞—Ä'
        };

        async function loadDeviceData() {
            const devicesDiv = document.getElementById('devices');
            devicesDiv.innerHTML = '';

            for (const deviceId of devices) {
                try {
                    // –û—Ç—Ä–∏–º—É—î–º–æ –ø–æ—Ç–æ—á–Ω–∏–π WQI
                    const wqiResponse = await fetch(`http://localhost:1880/api/getWQI?device=${deviceId}`);
                    const wqiData = await wqiResponse.json();

                    // –û—Ç—Ä–∏–º—É—î–º–æ —ñ—Å—Ç–æ—Ä—ñ—é
                    const historyResponse = await fetch(`http://localhost:1880/api/getParameterHistory?device=${deviceId}&parameter=wqi&hours=24`);
                    const historyData = await historyResponse.json();

                    const deviceDiv = document.createElement('div');
                    deviceDiv.className = 'device';
                    deviceDiv.innerHTML = `
                        <h3>üì± ${deviceNames[deviceId]} (${deviceId})</h3>
                        <div class="wqi-value">WQI: ${wqiData.wqi}</div>
                        <div><strong>–î–∂–µ—Ä–µ–ª–æ —ñ—Å—Ç–æ—Ä—ñ—ó:</strong> ${historyData.source}</div>
                        <div><strong>–ö—ñ–ª—å–∫—ñ—Å—Ç—å —Ç–æ—á–æ–∫:</strong> ${historyData.count}</div>
                        <div class="history">
                            <h4>–Ü—Å—Ç–æ—Ä—ñ—è (–æ—Å—Ç–∞–Ω–Ω—ñ 5 —Ç–æ—á–æ–∫):</h4>
                            ${historyData.data.slice(-5).map(point => 
                                `<div class="history-point">
                                    ${new Date(point.timestamp).toLocaleString()} - WQI: ${point.value}
                                </div>`
                            ).join('')}
                        </div>
                    `;
                    devicesDiv.appendChild(deviceDiv);

                } catch (error) {
                    console.error(`–ü–æ–º–∏–ª–∫–∞ –¥–ª—è –ø—Ä–∏—Å—Ç—Ä–æ—é ${deviceId}:`, error);
                }
            }
        }

        // –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ –¥–∞–Ω—ñ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç—ñ
        loadDeviceData();

        // –û–Ω–æ–≤–ª—é—î–º–æ –∫–æ–∂–Ω—ñ 10 —Å–µ–∫—É–Ω–¥
        setInterval(loadDeviceData, 10000);
    </script>
</body>
</html>
