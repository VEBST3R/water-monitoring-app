# Water Monitoring App 💧

Професійний мобільний додаток для моніторингу якості води в реальному часі з інтеграцією IoT датчиків та строгою системою оцінки WQI (Water Quality Index).

## 📋 Зміст

1. [Огляд проєкту](#огляд-проєкту)
2. [Архітектура системи](#архітектура-системи)
3. [Технологічний стек](#технологічний-стек)
4. [Структура проєкту](#структура-проєкту)
5. [Основні функції](#основні-функції)
6. [Алгоритм WQI](#алгоритм-wqi)
7. [Компоненти та модулі](#компоненти-та-модулі)
8. [API та інтеграція](#api-та-інтеграція)
9. [Налаштування та запуск](#налаштування-та-запуск)
10. [Тестування](#тестування)
11. [Розробка та подальші покращення](#розробка-та-подальші-покращення)

## 🎯 Огляд проєкту

Water Monitoring App - це повнофункціональний мобільний додаток для моніторингу якості води, який інтегрується з IoT датчиками та забезпечує реальний час аналізу водних параметрів. Додаток використовує строгий алгоритм розрахунку WQI, що враховує критичні показники забруднення води.

### Основні цілі проєкту:

- **Реалістичний моніторинг**: Строгий алгоритм оцінки якості води з пріоритетом критичних параметрів
- **Реальний час**: Отримання даних від IoT датчиків кожні 5 секунд
- **Інтуїтивний UX**: Сучасний інтерфейс з анімаціями та візуалізацією
- **Аналітика**: Історичні дані та тренди якості води
- **Масштабованість**: Підтримка множини пристроїв та локацій

## 🏗️ Архітектура системи

```
┌─────────────────┐    ┌──────────────────┐    ┌─────────────────┐
│   IoT Датчики   │────│   Node-RED       │────│  React Native   │
│                 │    │   (Middleware)   │    │     App         │
│ • pH сенсор     │    │                  │    │                 │
│ • TDS метр      │    │ • Симуляція      │    │ • Візуалізація  │
│ • Турбідіметр   │    │ • Валідація      │    │ • Аналітика     │
│ • Термометр     │    │ • API ендпоінти  │    │ • Уведомлення   │
└─────────────────┘    └──────────────────┘    └─────────────────┘
```

### Потік даних:

1. **Збір даних**: IoT датчики збирають параметри води (pH, TDS, турбідність, температура)
2. **Обробка**: Node-RED обробляє та валідує дані
3. **Розрахунок WQI**: Мобільний додаток розраховує індекс якості води
4. **Візуалізація**: Дані відображаються в реальному часі з анімаціями
5. **Зберігання**: Історичні дані зберігаються для аналітики

## 🛠️ Технологічний стек

### Frontend (React Native)

- **React Native 0.79.2**: Основний фреймворк для розробки
- **Expo 53.0.9**: Платформа для розробки та деплою
- **TypeScript**: Строга типізація коду
- **Expo Router 5.0.7**: Навігація та маршрутизація

### UI/UX Бібліотеки

- **React Native Reanimated 3.17.4**: Плавні анімації та інтерактивності
- **React Native Gesture Handler 2.24.0**: Обробка жестів
- **React Native Chart Kit 6.12.0**: Діаграми та візуалізація даних
- **React Native SVG 15.11.2**: Векторна графіка
- **@expo/vector-icons 14.0.0**: Іконки
- **Expo Haptics 14.1.4**: Тактільний зворотний зв'язок

### Стан та зберігання

- **React Hooks**: Управління станом компонентів
- **AsyncStorage 2.1.2**: Локальне зберігання даних користувача
- **React Context**: Глобальний стан додатку

### Мережа та API

- **Fetch API**: HTTP запити до Node-RED сервера
- **REST API**: Комунікація з backend сервісами
- **Express 5.1.0**: Backend сервер (для розробки)
- **CORS 2.8.5**: Cross-origin запити

### Навігація та UX

- **React Navigation 7.x**: Навігаційна система
- **Expo Router**: File-based маршрутизація
- **Safe Area Context 5.4.0**: Безпечні зони екрану
- **Expo Status Bar 2.2.3**: Управління статус баром

### Розробка та інструменти

- **Metro React Native Babel Preset**: Bundler конфігурація
- **ESLint**: Лінтер коду
- **Expo CLI**: Інструменти розробки

## 📁 Структура проєкту

```
water-monitoring-app/
├── 📱 app/                          # Екрани та навігація (Expo Router)
│   ├── _layout.tsx                  # Кореневий layout додатку
│   ├── +not-found.tsx               # 404 сторінка
│   └── (tabs)/                      # Tab-based навігація
│       ├── _layout.tsx              # Tabs layout
│       └── index.tsx                # Головний екран моніторингу
│
├── 🧩 components/                   # React компоненти
│   ├── ScoreCircle.tsx              # Кругова візуалізація WQI
│   ├── WQIChartView.tsx             # Діаграми історичних даних
│   ├── DetailedParametersView.tsx   # Детальний вигляд параметрів
│   ├── DeviceSelectionView.tsx      # Вибір та управління пристроями
│   ├── DeviceStatusView.tsx         # Статус підключення пристрою
│   ├── WaveAnimation.tsx            # Анімація хвиль води
│   ├── ParameterCircle.tsx          # Візуалізація окремих параметрів
│   ├── ThemedText.tsx               # Текстовий компонент з темою
│   ├── ThemedView.tsx               # View компонент з темою
│   └── ui/                          # UI компоненти
│       ├── IconSymbol.tsx           # Символи та іконки
│       └── TabBarBackground.tsx     # Фон таб бару
│
├── 🎨 constants/                    # Константи та конфігурація
│   └── Colors.ts                    # Колірна палітра додатку
│
├── 🪝 hooks/                        # Custom React hooks
│   ├── useColorScheme.ts            # Хук для теми (світла/темна)
│   ├── useDeviceStatus.ts           # Хук для статусу пристрою
│   └── useThemeColor.ts             # Хук для кольорів теми
│
├── 🔧 utils/                        # Утилітарні функції
│   ├── wqiUtils.ts                  # Розрахунок WQI (основний алгоритм)
│   └── colorUtils.ts                # Утиліти для роботи з кольорами
│
├── 📝 types/                        # TypeScript типи
│   └── index.ts                     # Основні типи даних
│
├── 🖼️ assets/                       # Статичні ресурси
│   ├── fonts/                       # Шрифти
│   └── images/                      # Зображення та іконки
│
├── 🧪 Тестові файли:
│   ├── test-current-wqi.js          # Тест поточного WQI
│   ├── test-strict-wqi.js           # Тест строгого алгоритму
│   ├── test-wqi-fix.js              # Тест виправлень WQI
│   └── test-wqi.js                  # Основні тести WQI
│
├── 🔄 Скрипти автоматизації:
│   └── fix-turbidity.js             # Автоматичне виправлення турбідності
│
└── 📋 Конфігураційні файли:
    ├── package.json                 # NPM залежності та скрипти
    ├── app.json                     # Expo конфігурація
    ├── tsconfig.json                # TypeScript конфігурація
    └── eslint.config.js             # ESLint правила
```

## ⭐ Основні функції

### 1. 🎯 Реальний час моніторинг

- **Автоматичне оновлення** кожні 5 секунд
- **Живі анімації** зміни параметрів
- **Статус підключення** до IoT датчиків
- **Візуальні індикатори** якості води

### 2. 📊 Строгий алгоритм WQI

```typescript
// Ваги параметрів (по пріоритету забруднення)
const weights = {
  turbidity: 0.5, // Найвищий вплив - прямий індикатор забруднення
  tds: 0.4, // Високий вплив - розчинені забруднювачі
  pH: 0.08, // Нижчий вплив - хімічна безпека
  temperature: 0.02, // Найнижчий вплив - смак та комфорт
};
```

### 3. 🎨 Адаптивна колірна система

- **Синій → Коричневий градієнт**: від відмінної до поганої води
- **Динамічні кольори**: змінюються відповідно до WQI
- **Консистентність**: однакові кольори в усіх компонентах

### 4. 📈 Аналітика та історія

- **Історичні діаграми** за 8/24 години
- **Статистика**: мін/макс/середнє значення
- **Тренди змін** якості води
- **Експорт даних** для аналізу

### 5. 🔧 Управління пристроями

- **Множинні пристрої**: підтримка декількох локацій
- **Налаштування підключення**: IP адреси та порти
- **Статус моніторинг**: онлайн/офлайн індикатори
- **Автоматичне перепідключення** при втраті зв'язку

## 🧮 Алгоритм WQI (Water Quality Index)

### Філософія строгого алгоритму:

Алгоритм розроблено з акцентом на **реалістичну оцінку якості води** з пріоритетом параметрів, що найбільше впливають на безпеку та придатність води для споживання.

### Система вагових коефіцієнтів:

```typescript
const weights = {
  turbidity: 0.5, // 50% - Турбідність (мутність води)
  tds: 0.4, // 40% - Загальні розчинені солі
  pH: 0.08, // 8%  - Кислотність
  temperature: 0.02, // 2%  - Температура
};
```

### Детальний розрахунок параметрів:

#### 1. 🌫️ Турбідність (Turbidity) - 50% ваги

```
• 0-1 NTU: 100-90 балів (Відмінна прозорість)
• 1-2 NTU: 90-75 балів (Добра прозорість)
• 2-4 NTU: 75-50 балів (Помітна мутність)
• 4-5 NTU: 50-35 балів (Погана якість)
• >5 NTU: ≤35 балів (Критична мутність)
```

#### 2. ⚗️ TDS (Total Dissolved Solids) - 40% ваги

```
• 0-150 ppm: 100-95 балів (Ідеальна чистота)
• 150-300 ppm: 95-85 балів (Відмінна якість)
• 300-500 ppm: 85-60 балів (Добра якість)
• 500-1000 ppm: 60-30 балів (Погана якість)
• >1000 ppm: ≤30 балів (Критичне забруднення)
```

#### 3. 🧪 pH (Кислотність) - 8% ваги

```
• 6.8-7.5: 100-92 балів (Оптимальний діапазон)
• 6.5-6.8 / 7.5-8.0: 85-60 балів (Прийнятний)
• 6.0-6.5 / 8.0-8.5: 60-45 балів (Проблемний)
• <6.0 / >8.5: ≤30 балів (Критичний)
```

#### 4. 🌡️ Температура - 2% ваги

```
• 15-25°C: 100-90 балів (Комфортна)
• 10-15°C / 25-30°C: 85-70 балів (Прийнятна)
• 5-10°C / 30-35°C: 60-40 балів (Некомфортна)
• <5°C / >35°C: ≤40 балів (Проблемна)
```

### Система штрафів:

- **TDS > 500 ppm**: WQI обмежується до 39
- **Турбідність > 5 NTU**: WQI обмежується до 39
- **pH < 6.0 або > 9.0**: WQI обмежується до 39
- **TDS > 1000 ppm**: WQI обмежується до 29

### Шкала якості води:

```
🟢 85-100: Відмінна
🟡 70-84:  Хороша
🟠 50-69:  Прийнятна
🔴 30-49:  Погана
⚫ 0-29:   Дуже погана
```

## 🧩 Компоненти та модулі

### 🎯 ScoreCircle.tsx

Центральний компонент відображення WQI у вигляді кругової діаграми.

**Основні функції:**

- Анімована кругова прогрес-бар
- Динамічна зміна кольору відповідно до WQI
- Текстове відображення значення та статусу
- Тактільний зворотний зв'язок при натисканні

**Технічні деталі:**

```typescript
// Анімація кругового прогресу
const animatedProps = useAnimatedProps(() => ({
  strokeDashoffset: strokeDashoffset.value,
}));

// Колірна анімація
const currentColorSV = useSharedValue(getWaterQualityColor(score));
```

### 📊 WQIChartView.tsx

Компонент для відображення історичних даних та трендів WQI.

**Основні функції:**

- Лінійні діаграми за різні періоди (8/24 години)
- Статистика (мін/макс/середнє)
- Легенда якості води
- Fallback дані при відсутності з'єднання

**API інтеграція:**

```typescript
// Отримання поточного WQI
GET /api/getWQI?device=${deviceId}

// Отримання історичних даних
GET /api/getParameterHistory?device=${deviceId}&parameter=wqi&hours=8
```

### 🔍 DetailedParametersView.tsx

Детальний вигляд всіх параметрів води з індивідуальними візуалізаціями.

**Параметри що відображаються:**

- pH (кислотність)
- Температура
- TDS (загальні розчинені солі)
- Турбідність (мутність)

**Логіка статусу:**

```typescript
// Пріоритет відображення проблем
if (turbidity > 5) return "Критична мутність";
if (tds > 500) return "Високий TDS";
if (pH < 6.0 || pH > 9.0) return "Критичний pH";
// ... інші перевірки
```

### 🌊 WaveAnimation.tsx

Анімований компонент хвиль води для створення атмосфери.

**Технічні особливості:**

- SVG анімація хвиль
- Responsive дизайн
- Плавні переходи кольорів
- Оптимізована продуктивність

### 📱 DeviceSelectionView.tsx

Управління множинними пристроями моніторингу.

**Функціональність:**

- Список підключених пристроїв
- Додавання нових пристроїв
- Налаштування з'єднання
- Видалення пристроїв

## 🔌 API та інтеграція

### Node-RED Backend

Додаток інтегрується з Node-RED сервером, який забезпечує:

#### Ендпоінти API:

```
POST /api/getWQI?device={deviceId}
┌─ Отримання поточного WQI та параметрів
└─ Response: { wqi: number, parameters: WaterParameters }

GET /api/getParameterHistory?device={deviceId}&parameter={param}&hours={hours}
┌─ Історичні дані параметрів
└─ Response: { data: Array<{timestamp, value, ...}> }

POST /api/addDevice
┌─ Додавання нового пристрою
└─ Body: { deviceId, name, location }

GET /api/deviceStatus?device={deviceId}
┌─ Статус підключення пристрою
└─ Response: { status: 'online' | 'offline', lastSeen: timestamp }
```

### Конфігурація з'єднання:

```typescript
const CENTRAL_SERVER_ENDPOINT = "192.168.1.101:1880";

// Автоматичне оновлення кожні 5 секунд
const UPDATE_INTERVAL = 5000;
```

### Обробка помилок:

- **Таймаути**: Автоматичне перепідключення
- **Мережеві помилки**: Fallback на локальні дані
- **Валідація даних**: Перевірка типів та діапазонів
- **Retry логіка**: Повторні спроби з експоненційним затримкою

## 🚀 Налаштування та запуск

### Передумови:

```bash
# Node.js (рекомендована версія 18+)
node --version

# npm або yarn
npm --version

# Expo CLI
npm install -g @expo/cli
```

### Встановлення:

```bash
# Клонування проєкту
git clone <repository-url>
cd water-monitoring-app

# Встановлення залежностей
npm install

# Автоматичне виправлення турбідності та запуск
npm start

# Альтернативно - тільки виправлення турбідності
npm run fix-turbidity
```

### Скрипти package.json:

```json
{
  "scripts": {
    "start": "node fix-turbidity.js && expo start",
    "android": "expo start --android",
    "ios": "expo start --ios",
    "web": "expo start --web",
    "lint": "expo lint",
    "fix-turbidity": "node fix-turbidity.js"
  }
}
```

### Конфігурація Node-RED:

1. Встановити Node-RED
2. Імпортувати flows.json
3. Налаштувати ендпоінти API
4. Запустити симуляцію датчиків

### Налаштування пристроїв:

```typescript
// У додатку додати новий пристрій:
{
  userDeviceName: "Кухонний фільтр",
  serverConfig: {
    deviceId: "111001",
    serverUrl: "192.168.1.101:1880"
  }
}
```

## 🧪 Тестування

### Тестові файли:

#### test-current-wqi.js

Тестування поточного алгоритму WQI:

```bash
node test-current-wqi.js
```

#### test-strict-wqi.js

Тестування строгого алгоритму:

```bash
node test-strict-wqi.js
```

#### fix-turbidity.js

Автоматичне виправлення значень турбідності:

```bash
node fix-turbidity.js
```

### Тестові сценарії:

#### 1. Тест відмінної води:

```javascript
const excellentWater = {
  pH: 7.2,
  temperature: 20,
  tds: 120,
  turbidity: 0.5,
};
// Очікуваний WQI: 95-100
```

#### 2. Тест проблемної води:

```javascript
const problematicWater = {
  pH: 8.8,
  temperature: 28,
  tds: 800,
  turbidity: 6.2,
};
// Очікуваний WQI: 25-35 (із штрафами)
```

#### 3. Тест критичної води:

```javascript
const criticalWater = {
  pH: 5.5,
  temperature: 35,
  tds: 1200,
  turbidity: 8.0,
};
// Очікуваний WQI: ≤29 (множинні штрафи)
```

## 📈 Розробка та подальші покращення

### Поточні можливості:

✅ Строгий алгоритм WQI  
✅ Реальний час моніторинг  
✅ Історичні діаграми  
✅ Управління пристроями  
✅ Responsive дизайн  
✅ Обробка помилок

### Планові покращення:

#### 🔔 Система уведомлень

- Push notifications при критичних значеннях
- Налаштовувані пороги сповіщень

#### 📊 Розширена аналітика

- Машинне навчання для прогнозування
- Порівняння з нормативами WHO/EPA
- Експорт в CSV/PDF формати

#### 🌐 Cloud інтеграція

- Синхронізація між пристроями
- Backup історичних даних
- Multi-tenant архітектура

#### 🏭 Промислові функції

- Калібрування датчиків
- Технічне обслуговування графіки
- Compliance звітність

#### 🔐 Безпека та приватність

- Шифрування даних
- Аутентифікація користувачів
- GDPR compliance

### Архітектурні покращення:

#### 📱 Мобільні платформи

- React Native Web версія
- PWA підтримка
- Offline mode з синхронізацією

#### ⚡ Продуктивність

- Redux для складного стану
- Мемоїзація компонентів
- Lazy loading екранів

#### 🧪 Тестування

- Unit тести (Jest)
- Integration тести
- E2E тести (Detox)

## 📚 Документація коду

### Ключові утилітарні функції:

#### wqiUtils.ts

```typescript
/**
 * Розраховує Water Quality Index на основі параметрів води
 * @param params - Параметри води (pH, температура, TDS, турбідність)
 * @returns WQI значення 0-100 (вище = краще)
 */
export const calculateWQI = (params: WaterParameters): number
```

#### colorUtils.ts

```typescript
/**
 * Повертає колір відповідно до WQI значення
 * @param wqi - Water Quality Index (0-100)
 * @returns Колір у форматі HEX
 */
export const getWaterQualityColor = (wqi: number): string
```

### Типи даних:

#### WaterParameters

```typescript
interface WaterParameters {
  pH: number; // 0-14 (кислотність)
  temperature: number; // °C (температура)
  tds: number; // ppm (загальні розчинені солі)
  turbidity: number; // NTU (турбідність/мутність)
}
```

#### UserDevice

```typescript
interface UserDevice {
  userDeviceName: string; // Назва від користувача
  serverConfig: {
    deviceId: string; // ID пристрою в системі
    serverUrl?: string; // URL сервера (опціонально)
  };
}
```
